<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>!!! SYSTEM COMPROMISED !!!</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Tone.js for audio drones and jump scares -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
    <!-- Load Inter font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Space+Mono:wght[400;700]&display=swap" rel="stylesheet">
    
    <style>
        /* --- Core Styling --- */
        :root {
            --devil-red: #ff3333;
            --devil-green: #33ff33;
        }

        body {
            font-family: 'Space Mono', monospace;
            background-color: #0d0d0d;
            color: var(--devil-green);
            overflow: hidden; 
            transition: all 0.5s ease-in-out;
            touch-action: manipulation;
        }

        /* --- Terminal Screen Container and Glitch Effect --- */
        .terminal-screen {
            box-shadow: 0 0 15px var(--devil-green), 0 0 30px var(--devil-red) inset;
            border: 2px solid var(--devil-red);
            padding: 2rem;
            min-height: 100vh;
            animation: text-flicker 0.1s infinite alternate;
            transition: all 0.5s ease-in-out;
        }

        @keyframes text-flicker {
            0% { filter: contrast(100%); opacity: 1; }
            50% { filter: contrast(95%); opacity: 0.98; }
            100% { filter: contrast(105%); opacity: 1; }
        }
        
        /* New: Ultra-fast glitch for the final 10 seconds */
        .panic-glitch {
            animation: panic-flicker 0.05s infinite alternate !important;
        }
        @keyframes panic-flicker {
            0% { filter: contrast(120%); opacity: 1; transform: translateX(2px); }
            50% { filter: contrast(80%); opacity: 0.9; transform: translateX(-2px); }
            100% { filter: contrast(110%); opacity: 1; transform: translateX(0); }
        }


        /* --- Code Rain Background (Intense Visual Noise) --- */
        .code-rain {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
            opacity: 0.25;
            background: repeating-linear-gradient(
                to bottom,
                transparent,
                transparent 1px,
                var(--devil-green) 1px,
                var(--devil-green) 3px
            );
            animation: scanline 2s linear infinite;
            transition: opacity 0.5s ease-in-out;
        }

        @keyframes scanline {
            0% { background-position: 0 0; }
            100% { background-position: 0 60px; }
        }

        .main-content {
            position: relative;
            z-index: 10;
        }

        /* --- Final Stage (Horror Mode) Styling --- */
        .horror-mode {
            background-color: #300000 !important;
            color: var(--devil-red) !important;
        }
        .horror-mode .terminal-screen {
            box-shadow: 0 0 20px var(--devil-red), 0 0 40px var(--devil-red) inset;
            border-color: var(--devil-red) !important;
        }
        .horror-mode .code-rain {
            opacity: 0.4 !important;
            background: repeating-linear-gradient(
                to bottom,
                transparent,
                transparent 1px,
                var(--devil-red) 1px,
                var(--devil-red) 3px
            ) !important;
        }
        
        /* Animation for the data transfer arrow */
        @keyframes transfer-glow {
            0%, 100% { box-shadow: 0 0 7px var(--devil-red); }
            50% { box-shadow: 0 0 15px var(--devil-red), 0 0 30px var(--devil-red); }
        }

        .transfer-arrow {
            animation: transfer-glow 0.8s ease-in-out infinite;
        }

        /* Blinking cursor effect */
        .blinking-cursor {
            font-weight: bold;
            animation: blink 0.5s infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0; }
        }

        .text-stage-title { color: var(--devil-red); text-shadow: 0 0 8px var(--devil-red); }
        .text-timer { color: var(--devil-green); text-shadow: 0 0 8px var(--devil-green); }

        .checkbox-item {
            display: flex;
            align-items: center;
            font-size: 1.25rem;
            margin-bottom: 0.75rem;
        }
        .checkbox-item input[type="checkbox"] {
            appearance: none;
            width: 1.5rem;
            height: 1.5rem;
            border: 2px solid var(--devil-red);
            margin-right: 1rem;
            position: relative;
            cursor: default;
        }
        .checkbox-item input[type="checkbox"]:checked:after {
            content: 'X';
            color: var(--devil-red);
            font-size: 1.25rem;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
    </style>
</head>
<body class="bg-[#0d0d0d] text-green-500 flex items-center justify-center">

    <div id="app" class="terminal-screen w-full max-w-4xl mx-auto rounded-lg shadow-2xl p-4 sm:p-8">
        <!-- The Hacking Background Effect (Code Rain) -->
        <div id="code-rain" class="code-rain"></div>

        <div class="main-content space-y-8">
            
            <!-- Stage 0: Welcome Screen -->
            <div id="stage-0" class="text-center transition-opacity duration-1000">
                <h1 class="text-3xl sm:text-5xl font-bold text-stage-title mb-4 animate-pulse">
                    [[ INITIATING HOSTILE SESSION: TRACE ENABLED ]]
                </h1>
                <p class="text-xl sm:text-2xl text-green-400">
                    <span class="text-red-500 font-extrabold">WHITE DEVIL</span> is now listening to your device<span class="blinking-cursor">_</span>
                </p>
                <p id="audio-status" class="mt-8 text-sm text-yellow-500">
                    <span class="text-red-600">WARNING:</span> CLICK ANYWHERE TO CONFIRM DEVICE SIGNATURE AND START PRANK.
                    <br><span class="text-white font-bold">(This will also start the full-screen experience)</span>
                </p>
            </div>

            <!-- Stage 1, 2, 3: Simulation Active -->
            <div id="stage-active" class="hidden space-y-6">
                
                <!-- Target Identification Block -->
                <div class="text-sm text-gray-400 border-b border-green-700 pb-2 mb-4">
                    <p class="font-bold text-red-500">TARGET ACQUIRED & VALIDATED:</p>
                    <p>IP: <span id="spoofed-ip">172.31.255.42</span> (Local Network)</p>
                    <p>GEOLOC: <span id="spoofed-location">San Francisco, CA, USA</span> | OS: <span id="spoofed-os">iOS 18.1</span></p>
                    <p>OWNER: <span id="spoofed-owner" class="text-red-500 font-bold">USER_ID_88B3F2E</span></p>
                </div>
                
                <!-- Timer -->
                <div class="text-center border-b border-red-900 pb-4">
                    <p class="text-lg sm:text-xl font-bold text-stage-title mb-2">
                        TIME REMAINING UNTIL FULL CONTROL IS SEIZED
                    </p>
                    <div class="text-5xl sm:text-7xl font-extrabold text-timer">
                        <span id="countdown-timer">00:60</span>
                    </div>
                </div>

                <!-- Live Status and Progress Bar -->
                <div>
                    <p id="status-message" class="stage-message text-xl sm:text-2xl font-bold text-red-500 mb-2">
                        // PHASE 1: TARGETING YOUR FRONT-FACING CAMERA...
                    </p>
                    <div class="w-full bg-gray-900 border border-red-700 rounded-full h-4 sm:h-6">
                        <div id="progress-bar" class="bg-green-500 h-full rounded-full transition-none" style="width: 0%"></div>
                    </div>
                    <div class="flex justify-between text-sm mt-1">
                        <span class="text-red-500">SYSTEM INFILTRATION PROGRESS</span>
                        <span id="progress-percentage" class="text-green-500 font-bold">0%</span>
                    </div>
                </div>

                <!-- Data Transfer Visualization -->
                <div class="flex flex-col sm:flex-row items-center justify-around text-center mt-6">
                    <!-- User Phone -->
                    <div class="w-full sm:w-1/3 p-2 border border-green-700 rounded-xl shadow-lg shadow-green-900/50">
                        <p class="text-sm text-red-500">TARGET DEVICE (YOU)</p>
                        <p class="text-lg font-bold">BREACH POINT: ACTIVE</p>
                        <svg class="w-8 h-8 mx-auto mt-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z" />
                        </svg>
                    </div>

                    <!-- Transfer Arrow -->
                    <div class="my-4 sm:my-0 sm:w-1/6 flex justify-center items-center">
                        <span class="text-red-500 text-3xl transfer-arrow">&rArr;</span>
                    </div>
                    
                    <!-- Dark Web Hub -->
                    <div class="w-full sm:w-1/3 p-2 border border-red-700 rounded-xl shadow-lg shadow-red-900/50">
                        <p class="text-sm text-green-500">WHITE DEVIL DATA STREAM</p>
                        <p class="text-lg font-bold">EXFILTRATION HUB</p>
                        <svg class="w-8 h-8 mx-auto mt-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9h-3M12 21a9 9 0 01-9-9m9 9v-3M3 12h3M12 3v3m0 0V3m0 3a9 9 0 00-9 9m3 3h3m0 0v-3m-3 3h-3" />
                        </svg>
                    </div>
                </div>

                <!-- Log Console (Taller for more visual data) -->
                <div class="h-48 bg-black p-2 overflow-y-scroll text-sm border border-green-700/50">
                    <pre id="log-console" class="text-green-400"></pre>
                </div>

            </div>

            <!-- Stage 4: Completion Screen (Horror Climax with Checklist) -->
            <div id="stage-final" class="hidden text-center transition-opacity duration-1000 p-8">
                <h1 class="text-5xl sm:text-6xl font-extrabold mb-4 text-stage-title animate-pulse">
                    <span class="text-red-500">!!! SYSTEM OVERRIDE COMPLETE !!!</span>
                </h1>
                
                <p class="text-2xl sm:text-3xl font-bold text-red-400 mb-6">
                    [ WHITE DEVIL ] ACCESS CONFIRMED:
                </p>

                <!-- Checkbox List -->
                <div class="text-left max-w-md mx-auto my-8">
                    <div class="checkbox-item">
                        <input type="checkbox" checked disabled>
                        <span>ALL CONTACTS & MESSAGES ACQUIRED</span>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" checked disabled>
                        <span>BANKING & FINANCIAL CREDENTIALS CACHED</span>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" checked disabled>
                        <span>LIVE CAMERA & MICROPHONE FEEDS ESTABLISHED</span>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" checked disabled>
                        <span>LOCATION TRACKING LOCKED (Permanent)</span>
                    </div>
                </div>

                <div class="mt-12 text-4xl sm:text-5xl text-red-500 font-extrabold animate-bounce">
                    <p>I T &nbsp; W A S N ' T &nbsp; A &nbsp; P R A N K</p>
                </div>
                <!-- Prank reset button -->
                <button onclick="resetAndRestart();" class="mt-12 px-6 py-3 bg-red-800 text-white font-bold rounded-md hover:bg-red-900 transition duration-300 shadow-xl shadow-red-900/50">
                    ATTEMPT SYSTEM REBOOT (Failsafe Deactivated)
                </button>
            </div>

        </div>
    </div>

    <script>
        // --- Configuration ---
        const DURATION = 60; 
        const PROGRESS_RATE = 30; 
        const LOG_MESSAGE_INTERVAL = 1000; 

        // --- API Setup ---
        const apiKey = "";
        const ttsApiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-tts:generateContent?key=${apiKey}`;
        const ttsPrompt = "System intrusion successful. All data access confirmed. Contacts, financials, and location are now property of White Devil. You have lost control.";
        let audioUrl = null;
        let audioStatusElement = document.getElementById('audio-status');
        let droneSynth = null;
        let terminalScreen = document.getElementById('app');

        // --- State Variables ---
        let timerInterval = null;
        let progressInterval = null;
        let logInterval = null;
        let seconds = DURATION;
        let progress = 0;
        let statusIndex = 0;
        let isSimulationRunning = false;
        let isAudioSetup = false;

        // --- DOM Elements (Repeated for clarity) ---
        const body = document.body;
        const stage0 = document.getElementById('stage-0');
        const stageActive = document.getElementById('stage-active');
        const stageFinal = document.getElementById('stage-final');
        const timerDisplay = document.getElementById('countdown-timer');
        const progressBar = document.getElementById('progress-bar');
        const progressPercentage = document.getElementById('progress-percentage');
        const statusMessage = document.getElementById('status-message');
        const logConsole = document.getElementById('log-console');
        
        // --- Utility Functions for Audio Conversion ---
        
        function base64ToArrayBuffer(base64) {
            const binaryString = atob(base64);
            const len = binaryString.length;
            const bytes = new Uint8Array(len);
            for (let i = 0; i < len; i++) {
                bytes[i] = binaryString.charCodeAt(i);
            }
            return bytes.buffer;
        }

        function writeString(view, offset, string) {
            for (let i = 0; i < string.length; i++) {
                view.setUint8(offset + i, string.charCodeAt(i));
            }
        }

        function pcmToWav(pcm16, sampleRate = 24000) {
            const numChannels = 1;
            const bitsPerSample = 16;
            const byteRate = (sampleRate * numChannels * bitsPerSample) / 8;
            const blockAlign = (numChannels * bitsPerSample) / 8;
            
            const buffer = new ArrayBuffer(44 + pcm16.length * 2);
            const view = new DataView(buffer);

            // RIFF header
            writeString(view, 0, 'RIFF');
            view.setUint32(4, 36 + pcm16.length * 2, true);
            writeString(view, 8, 'WAVE');

            // fmt sub-chunk
            writeString(view, 12, 'fmt ');
            view.setUint32(16, 16, true);
            view.setUint16(20, 1, true);
            view.setUint16(22, numChannels, true);
            view.setUint32(24, sampleRate, true);
            view.setUint32(28, byteRate, true);
            view.setUint16(32, blockAlign, true);
            view.setUint16(34, bitsPerSample, true);

            // data sub-chunk
            writeString(view, 36, 'data');
            view.setUint32(40, pcm16.length * 2, true);

            // Write PCM data
            for (let i = 0; i < pcm16.length; i++) {
                view.setInt16(44 + i * 2, pcm16[i], true);
            }

            return new Blob([view], { type: 'audio/wav' });
        }
        
        // --- Persistent Audio Drone Logic (Tone.js) ---
        function setupAudioDrone() {
            if (isAudioSetup) return;
            Tone.context.lookAhead = 0.0; // Reduce latency
            
            // Create an oscillating synth for the persistent, low, unsettling drone
            droneSynth = new Tone.NoiseSynth({
                noise: {
                    type: "pink"
                },
                envelope: {
                    attack: 0.005,
                    decay: 0.1,
                    sustain: 0.8,
                    release: 0.5
                }
            }).toDestination();
            
            isAudioSetup = true;
        }

        function startDrone() {
            if (!isAudioSetup) setupAudioDrone();
             // Start the noise synth, set to loop quietly to build pressure
            droneSynth.volume.value = -30; // Very quiet
            droneSynth.triggerAttackRelease(DURATION + "s");
        }

        function stopDrone() {
            if (droneSynth) {
                droneSynth.triggerRelease();
            }
        }

        // --- API & Audio Fetching Logic ---

        async function fetchAndPrepareAudio() {
            audioStatusElement.textContent = "ATTENTION: PRE-CACHING HOSTILE VOICE MODULE...";
            
            const payload = {
                contents: [{
                    parts: [{ text: `Say in a deep, menacing voice, without being too loud, but with chilling intensity: ${ttsPrompt}` }]
                }],
                generationConfig: {
                    responseModalities: ["AUDIO"],
                    speechConfig: {
                        voiceConfig: {
                            prebuiltVoiceConfig: { voiceName: "Kore" } 
                        }
                    }
                },
                model: "gemini-2.5-flash-preview-tts"
            };

            const maxRetries = 3;
            for (let i = 0; i < maxRetries; i++) {
                try {
                    const response = await fetch(ttsApiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);

                    const result = await response.json();
                    const part = result?.candidates?.[0]?.content?.parts?.[0];
                    const audioData = part?.inlineData?.data;
                    const mimeType = part?.inlineData?.mimeType;

                    if (audioData && mimeType && mimeType.startsWith("audio/L16")) {
                        const sampleRate = 24000;
                        const pcmData = base64ToArrayBuffer(audioData);
                        const pcm16 = new Int16Array(pcmData);
                        const wavBlob = pcmToWav(pcm16, sampleRate);
                        audioUrl = URL.createObjectURL(wavBlob);
                        
                        audioStatusElement.textContent = "DEVICE IS ACTIVE. READY FOR SIMULATION.";
                        return;
                    } else {
                        throw new Error("Invalid audio data received from API.");
                    }
                } catch (error) {
                    console.error(`Attempt ${i + 1} failed: `, error);
                    if (i < maxRetries - 1) {
                        await new Promise(resolve => setTimeout(resolve, Math.pow(2, i) * 1000));
                    } else {
                
